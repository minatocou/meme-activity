function showPage(t,a){var e=a?$.extend(t.form.data().submitParam,a):t.form.data().submitParam;t=a?$.extend(t,a):t,ajaxReq({url:t.form[0].getAttribute("data-api"),data:e}).then(function(a){if("undefined"!=typeof a){a=a.data,initPager($.extend(t,{totalCount:a.totalCount,pageSize:e.pageSize}));var i={list:[].concat(a.productInfo||a.boxInfo)};i.list.forEach(function(t){t.dataStringify=JSON.stringify(t)}),t.dataContainer.html(parseTmpl({data:i,id:t.id}))}})}function formatList(t){var a=t,e={};return Object.keys(a).forEach(function(t){var i=a[t].giftBarCode||a[t].itemId;delete a[t].giftBarCode,delete a[t].itemId;var n=[],o=e[i]=Array.isArray(e[i])?e[i]:n;$.each(a[t],function(t,a){o.push(a)})}),e}!function(t){t('[name="searchType"]').change(function(){this.checked&&(t(this.getAttribute("data-bind"))[0].name=this.getAttribute("data-name"))});var a=2700,e={"add-part-modal":{action:"/master/addproduct",title:localeI18n.addNewPart,btnName:localeI18n.add,otherInfo:"addContinuity",hiddenFunc:function(){showPage(t("form.search-form[data-api]:visible").data().pageParam)},showFunc:function(){t(this).find(".download-tmpl").attr("href",APIHOST+"").end().find("form").validate({submitHandler:function(e){var i=t(e);ajaxReq({url:e.getAttribute("action"),type:"POST",data:i.serializeObject()}).then(function(t){if("undefined"!=typeof t){var e=i.closest(".modal");tipsShow(localeI18n.addSuccess,e.find(".modal-dialog")),i.trigger("reset"),e.find(".add-continuity")[0].checked||setTimeout(function(){e.modal("hide")},a)}})}})}},"add-box-modal":{action:"/master/addgift",title:localeI18n.addBox,btnName:localeI18n.add,hiddenFunc:function(){showPage(t("form.search-form[data-api]:visible").data().pageParam)},showFunc:function(){t(this).find("[data-create-item]").val(2).change().end().find('[name="prodType"]').eq(1).click();var e={sku:"sku",barcode:"barcode"};t(this).find("form").validate({submitHandler:function(i){var n=t(i);if(n.find("textarea:first-child").toArray().some(function(t){return""===t.value.replace(/(\r\n)|(\n)/gm,"").trim()}))return void tipsShow(localeI18n.cantAllowEmptyLine,n.closest(".modal-dialog"));var o=n.find('[name="prodType"]:checked').val().toLowerCase(),d={};n.find(".item-input-container").each(function(a){var i=[];d[a+1]=i,t(this).find("textarea").val().replace(/(\r\n)|(\n)/gm,"<br>").split("<br>").forEach(function(t){if(""!==t.trim()){var a={};a[e[o]]=t,i.push(a)}})});var r=n.find(".form-group input").serializeObject();r.prodType=r.prodType[0].toUpperCase(),r.prodItemDetail=JSON.stringify(d),ajaxReq({url:i.getAttribute("action"),type:"POST",data:r}).then(function(t){if("undefined"!=typeof t){var e=n.closest(".modal");tipsShow(localeI18n.addSuccess,e.find(".modal-dialog")),n.trigger("reset"),setTimeout(function(){e.modal("hide")},a)}})}})}},"import-file-modal":{action:"/master/importproduct",title:localeI18n.importPart,btnName:localeI18n.import,otherInfo:"downloadTmpl",hiddenFunc:function(){showPage(t("form.search-form[data-api]:visible").data().pageParam)},showFunc:function(){t(this).find("form").validate({submitHandler:function(e){var i=t(e),n=new FormData(e);ajaxReq({url:e.getAttribute("action"),type:"POST",data:n,processData:!1,contentType:!1}).then(function(t){if("undefined"!=typeof t){var e=i.closest(".modal");tipsShow(t.msg,e.find(".modal-dialog")),i.trigger("reset"),setTimeout(function(){e.modal("hide")},a)}})}})}},"edit-part-modal":{action:"/master/updateproduct",equalsTo:"add-part-modal",title:localeI18n.editPart,btnName:localeI18n.save,showFunc:function(e){var i=t(this).find("form").find("[data-unique]").prop("readonly",!0).end().find(":input[name]");fillInputData(i,JSON.parse(t(e.currentTarget).data("target").getAttribute("data-value"))),t(this).find("form").validate({submitHandler:function(e){var i=t(e);ajaxReq({url:e.getAttribute("action"),type:"POST",data:i.serializeObject()}).then(function(e){if("undefined"!=typeof e){var n=i.closest(".modal");tipsShow(localeI18n.addSuccess,n.find(".modal-dialog")),i.trigger("reset"),setTimeout(function(){n.modal("hide"),showPage(t("form.search-form[data-api]:visible").data().pageParam)},a)}})}})}}};t("body").on("click",'[data-toggle="modal"][data-modal]',function(){var a=this.getAttribute("data-modal"),i={id:"modal-template",data:{subModal:'${include "'+(e[a].equalsTo?e[a].equalsTo:a)+'"}',modalTitle:e[a].title,btnName:e[a].btnName}};e[a].otherInfo&&(i.data[e[a].otherInfo]="downloadTmpl"==e[a].otherInfo?APIHOST+"/master/exportTemplate":!0);var n=parseTmpl(i);initModal(t(parseTmpl({tmpl:n,data:{action:e[a].action}})).data({target:this}),{show:e[a].showFunc,hidden:e[a].hiddenFunc})}),t("body").on("click","[data-delete-sku][data-url]",function(){t(this);confirm(localeI18n.confirmOperation)&&ajaxReq({url:this.getAttribute("data-url"),type:"POST",data:{sku:this.getAttribute("data-delete-sku")}}).then(function(a){"undefined"!=typeof a&&(tipsShow(a.msg,t("body")),showPage(t("form.search-form[data-api]:visible").data().pageParam))})})}(jQuery),$("#query-component-modal").on("show.bs.modal",function(t){var a=$(this).data({sku:t.relatedTarget.getAttribute("data-sku")}).find('[data-toggle="tab"]').eq(0).click().end().end().find("[data-req][data-url]");a[0].setAttribute("href",APIHOST+a[0].getAttribute("data-req")+t.relatedTarget.getAttribute("data-sku"))}).on("hidden.bs.modal",function(){$(this).find('[name="showType"]').eq(1).click()}),$("body").on("change",'[name="showType"]',function(t){var a=this;$(t.delegateTarget).find(".item-input").each(function(t,e){e.value=$(e).data()[a.value]})}).on("change","[data-create-item]",function(){if(!(Number(this.value)<Number(this.getAttribute("min"))||-1!==this.value.indexOf("."))){var t=[],a=$(this).closest("form").find(".data-container"),e=a.children().length,i=Number(this.value)-e;if(i>0){for(var n=0;n<Number(this.value);n++)t[n]=e>n?!1:!0;a.append(parseTmpl({id:"create-item-input",data:{list:t}}))}else if(0>i)for(var n=0;n<Math.abs(i);n++)a.children().eq(-1).remove()}}).on("change",'[name="prodType"]',function(){var t=this.value.toLowerCase();$("#modal-frame [data-sku][data-barcode]").each(function(){this.value=this.getAttribute("data-"+t)})}).on("change","#modal-frame [data-sku][data-barcode]",function(){var t=$(this),a={sku:{key:"stringCheck",regx:function(){return/^([\w|-]+)$/g}},barcode:{key:"numberCheck",regx:function(){return/^([0-9]+)$/g}}},e=t.closest(".modal-content").find('[name="prodType"]:checked').val().toLowerCase(),i=a[e],n=localeI18n[i.key],o=this.value.replace(/(\r\n)|(\n)/gm,"<br>").split("<br>").reduce(function(t,a){return""!==a.trim()&&t.push(a.trim()),t},[]);if(!o.some(function(a){return i.regx().test(a)?void 0:(tipsShow(n,t.closest(".modal-dialog")),!0)})){var d=o.reduce(function(t,a){return t[a]?t.hasRepeat=!0:t[a]=1,t},{});return d.hasRepeat?(tipsShow(localeI18n.hasRepeat,t.closest(".modal-dialog")),this.value="",void this.focus()):void this.setAttribute("data-"+e,this.value)}});var validateInput=function(t,a,e){var i=$(this),n={};n[a.name]=a.value[0].toUpperCase(),n.product=this.value,ajaxReq({url:"/master/prodVerify",type:"post",data:n}).then(function(t){return"undefined"==typeof t?void i.val("").focus():void i[0].setAttribute("data-"+e,i[0].value)})};$("body").on("click",".tab-box-item",function(){var t=this.getAttribute("data-tmpl");initBoxAssemble.call(this,t)});