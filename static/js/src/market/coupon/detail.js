!function(){function e(){$('.change-coupon input[type="text"]').val(null),$('.fixed-coupon input[type="text"]').val(null)}function t(){for(var e=["description","discount","discount_type","expire_days","from_date","is_dynamic","name","rule","status","to_date","warehouse"],t={},a=0;a<e.length;a++)$("#"+e[a]).val().trim()&&(t[e[a]]=$("#"+e[a]).val().trim());t.platform=7,t.category=JSON.stringify($("#category").val().split(/,|，/)),getSearch("id")&&(t.id=getSearch("id")),t.user_name=$(".user-name").data("name"),console.log(t),$.ajax({url:CONFIG.dev.domain+"/coupon/update",data:t,dataType:"json",type:"POST",success:function(e){alert(e.msg),"1"==e.code&&history.back()},error:function(e){console.log(e)}})}var a=new MarketDetail("/coupon/view"),r=getSearch("id");r&&HistoryLog.init(r,"coupon"),a.getDetail(),$("#marketSaveBtn").click(function(){if(""==$("#name").val().trim())return alert("名称不能为空"),!1;if($("#name").val().length>50)return alert("名称不能大于50个字"),!1;if("0"==$("#is_dynamic").val()){if(""==$("#from_date").val()||""==$("#to_date").val())return alert("请输入有效期"),!1;if(!checkTime())return!1}else{if(""==$("#expire_days").val().trim())return alert("请输入有效期"),!1;if($("#expire_days").val().trim()>365)return alert("有效期不能大于365天"),!1;if($("#expire_days").val().trim()!=parseInt($("#expire_days").val().trim())||$("#expire_days").val().trim()<=0)return alert("有效期输入有误"),!1}return""==$("#rule").val()||""==$("#discount").val()?(alert("优惠设置不能为空"),!1):$("#rule").val()<0||$("#discount").val()<0?(alert("优惠设置填写有误"),!1):""==$("#category").val().trim()?(alert("category不能为空"),!1):void t()}),$("#detail").on("change","#is_dynamic",function(){$(".fixed-coupon").toggle(),$(".change-coupon").toggle(),e()}),$("#goBack").click(function(){location.href="/market/coupon"})}();