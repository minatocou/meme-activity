!function(){function t(){function t(t){n[t]=0!=$("#"+t+":checked").length?"1":"0"}var e=["from_date","to_date","name","description","warehouse","status","customer_group"],n={};e.map(function(t){n[t]=$("#"+t).val()}),n.discount=function(){for(var t=[],e=0,n=0;6>e;)t[n]=[$("#discount input")[e].value,$("#discount input")[e+1].value],n++,e+=2;return JSON.stringify(t)}(),t("compatible_coupon"),t("compatible_preference"),n.discount=function(){for(var t=[],e=0,n=0;6>e;)$("#discount input")[e].value.trim()&&(t[n]=[$("#discount input")[e].value,$("#discount input")[e+1].value],n++),e+=2;return JSON.stringify(t)}(),n.user_name=$(".user-name").data("name"),getSearch("id")&&(n.id=getSearch("id")),console.log(n),$.ajax({url:CONFIG.dev.domain+"/promotion/update",data:n,dataType:"json",type:"POST",success:function(t){alert(t.msg),"1"==t.code&&history.back()},error:function(t){console.log(t)}})}var e=new MarketDetail("/promotion/view"),n=getSearch("id");n&&HistoryLog.init(n,"promotion"),e.getDetail(),$("#marketSaveBtn").click(function(){return""==$("#name").val().trim()?(alert("名称不能为空"),!1):$("#name").val().length>50?(alert("名称不能大于50个字"),!1):""==$("#from_date").val()||""==$("#to_date").val()?(alert("请输入有效期"),!1):checkTime()?""==$("#discount .non-empty input")[0].value||""==$("#discount .non-empty input")[1].value?(alert("优惠设置不能为空"),!1):$("#discount .non-empty input")[0].value<0||$("#discount .non-empty input")[1].value<0?(alert("设置优惠填写有误"),!1):checkDiscount()?void t():!1:!1}),$("#goBack").click(function(){location.href="/market/warehouse"})}();