var resetForm=function(e){var a=$(CANVAS_PANEL).find(".cur"),t=JSON.parse(a.attr(SETTING));e=_.extend(t,e),a.attr(SETTING,JSON.stringify(e))},binChange=function(){var e=function(e){if(e.hasClass("removeSpace")){var a=$.trim(e.val());e.val(a)}var t=e.closest(attrClass),r=$(t).find("form.commonConf").eq(0);"0"==r.find(".has_change").val()&&r.find(".has_change").val("1");var n=$(t).find("form.commonConf").eq(0).serializeObject(),i=$(t).find(".singleConf form.singleItem"),s=$(i).length,o=[];if(s>0)for(var f=0;s>f;f++)o.push($(i[f]).serializeObject());var l=_.extend(n,{data:o});resetForm(l)};$(attrClass).on("blur","input,select,textarea",function(){e($(this))}),$(attrClass).on("click","input[type=checkbox]",function(){e($(this))})},resetBrandForm=function(e){var a=$(CANVAS_PANEL).find(".cur"),t=JSON.parse(a.attr(BRANDSET));e=_.extend(t,e),a.attr(BRANDSET,JSON.stringify(e))},brandChange=function(){$(attrClass).off().on("change",".brandcate-attr form input, .brandcate-attr select, .brandcate-attr textarea",function(){if($(this).hasClass("removeSpace")){var e=$.trim($(this).val());$(this).val(e)}var a=$(this).closest(attrClass),t=$(a).find("form.commonConf").eq(0);"0"==t.find(".has_change").val()&&t.find(".has_change").val("1");var r=$(a).find("form.commonConf").eq(0).serializeObject(),n=$(a).find(".singleConf form.singleItem"),i=$(n).length,s=[];if(i>0)for(var o=0;i>o;o++)s.push($(n[o]).serializeObject());var f=_.extend(r,{data:s});resetBrandForm(f)})},resetImageTextForm=function(e){var a=$(CANVAS_PANEL).find(".cur"),t=JSON.parse(a.attr(SETTING));e=_.extend(t,e),a.attr(SETTING,JSON.stringify(e))},imageTextChange=function(){$(".imagetext-attr").on("change","form input",function(){if($(this).hasClass("removeSpace")){var e=$.trim($(this).val());$(this).val(e)}var a=$(this).closest(".imagetext-attr"),t=$(a).find(".commonConf"),r=t.find(".has_change").val(),n={};"0"==r&&(t.find(".has_change").val("1"),n.has_change="1");var i=$(a).find(".singleConf form.singleItem"),s=$(i).length;if(s>0){var o=$(i).serializeObject(),f=o.ids;delete o.ids,o.data={ids:f}}var l=_.extend(n,o);resetImageTextForm(l)})},sortableInit=function(e){$(TEMPLATE_PANEL).sortable({group:{name:"template",pull:"clone"},sort:!1,fallbackOnBody:!0}),$(CANVAS_PANEL).sortable({group:{name:"canvas",put:["template"],draggable:"[data-field]"},draggable:".template",onUpdate:function(){console.log(123)},onAdd:function(e){var a=($(e.item),$(e.item).attr("data-field"));if("favorcom"==a&&$("#canvas .favorcom").length>1)return alert("猜你喜欢2组件不能有多个"),$(e.item).remove(),!1;if("favor"==a&&$("#canvas .favor").length>1)return alert("猜你喜欢组件不能有多个"),$(e.item).remove(),!1;!a&&$(e.item).attr("imagetext-field")&&(a=$(e.item).attr("imagetext-field"));var t={id:uuid(),type:a,has_change:"1"};DEFAULT_SETTING[a]&&(t=_.extend(t,DEFAULT_SETTING[a])),$(e.item).attr("id",t.id).attr(SETTING,JSON.stringify(t))}}),$(CANVAS_PANEL).on("click","[brand-field]",function(a){a.stopPropagation(),a.preventDefault();var t=$(this);t.addClass("cur").siblings(".cur").removeClass("cur");var r=t.attr("brand-field");for(var n in vueRefs)if(e.$refs[vueRefs[n]]){var i=e.$refs[vueRefs[n]];i.show=!1}var s=JSON.parse(t.attr(BRANDSET)),o=e.$refs[r+"form"];o.setting=s,o.show=!0,brandChange()}),brandChange(),$(CANVAS_PANEL).on("click","[imagetext-field]",function(a){a.stopPropagation(),a.preventDefault();var t=$(this);t.addClass("cur").siblings(".cur").removeClass("cur");var r=t.attr("imagetext-field");for(var n in vueRefs)if(e.$refs[vueRefs[n]]){var i=e.$refs[vueRefs[n]];i.show=!1}var s=JSON.parse(t.attr(SETTING)),o=e.$refs[r+"form"];o.setting=s,o.show=!0,imageTextChange()}),imageTextChange(),$(CANVAS_PANEL).on("click","[data-field]",function(a){a.stopPropagation(),a.preventDefault();var t=$(this);t.addClass("cur").siblings(".cur").removeClass("cur");var r=t.attr("data-field");for(var n in vueRefs)if(e.$refs[vueRefs[n]]){var i=e.$refs[vueRefs[n]];i.show=!1}var s=JSON.parse(t.attr(SETTING)),o=e.$refs[r+"form"];o.show=!0,o.setting=s,binChange()}),binChange(),$(CANVAS_PANEL).on("click",".close-btn",function(a){a.stopPropagation(),a.preventDefault();var t=$(this).parents("[data-field]"),r=$(this).parents("[imagetext-field]");if(0!=t.length){var n=t.attr("data-field"),i=e.$refs[n+"form"];i.show=!1,$(this).closest("li").remove()}else if(0!=r.length){var n=r.attr("imagetext-field"),i=e.$refs[n+"form"];i.show=!1,$(this).closest("li").remove()}})};