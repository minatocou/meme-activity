!function(){var a=Handlebars.compile($("#user-tpl").html()),e=Handlebars.compile($("#role-tpl").html());Handlebars.registerHelper("compare",function(a,e,t,n){if(arguments.length<3)throw new Error('Handlerbars Helper "compare" needs 2 parameters');var r={"==":function(a,e){return a==e},"===":function(a,e){return a===e},"!=":function(a,e){return a!=e},"!==":function(a,e){return a!==e},"<":function(a,e){return e>a},">":function(a,e){return a>e},"<=":function(a,e){return e>=a},">=":function(a,e){return a>=e},"typeof":function(a,e){return typeof a==e}};if(!r[e])throw new Error('Handlerbars Helper "compare" doesn\'t know the operator '+e);var o=r[e](a,t);return o?n.fn(this):n.inverse(this)}),$.ajax({type:"post",dataType:"json",url:"/api/author/getAll",beforeSend:function(){$(".user-list .loading").show(),$(".user-list > table").hide()},success:function(e){parseInt(e.code)&&(0!=e.data.length?$("#pagination-container").pagination({dataSource:e.data,callback:function(e){var t=a(e);$("#user-content").html(t)}}):$("#user-content").html("暂时没有数据"))},error:function(){console.log("出现异常")},complete:function(){$(".user-list .loading").hide(),$(".user-list > table").show()}}),Handlebars.registerHelper("ischecked",function(a){return"0"==a?"":"1"==a?"checked":void 0}),$(".newUser button").on("click",function(){$("#addModal").modal(),$("#addModal").find("#add-user-form")[0].reset(),$.ajax({type:"post",dataType:"json",url:"/api/role/getall",success:function(a){parseInt(a.code)&&($("#addModal .chk-group").html(e(a)),$("#add-user-form").find(".valid-msg").html(""),$("#add-user-form").find("input").removeClass("valid"))},error:function(){console.log("出现异常")}})}),$("#addModal .add").on("click",function(){if(!$(this).hasClass("disable")){var a=$("#add-user-form").find("input[name='realname']"),e=$("#add-user-form").find("input[name='username']"),t=$("#add-user-form").find("input[name='password']");if(""==$.trim(a.val()))return a.addClass("valid"),a.next(".valid-msg").html("用户名不能为空"),!1;if(a.removeClass("valid"),a.next(".valid-msg").html(""),""==$.trim(e.val()))return e.addClass("valid"),e.next(".valid-msg").html("登录名不能为空"),!1;if(!/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/.test(e.val()))return e.addClass("valid"),e.next(".valid-msg").html("登录名必须是邮箱"),!1;if(e.removeClass("valid"),e.next(".valid-msg").html(""),""==$.trim(t.val()))return t.addClass("valid"),t.next(".valid-msg").html("密码不能为空"),!1;if($.trim(t.val()).length<6)return t.addClass("valid"),t.next(".valid-msg").html("密码至少6位"),!1;t.removeClass("valid"),t.next(".valid-msg").html(""),$(this).addClass("disable");var n=this,r=!1;if($.ajax({type:"post",dataType:"json",async:!1,url:"/api/account/check",data:{username:$.trim(e.val())},success:function(a){a.data&&(alert("登录名已存在"),r=!0),$(n).removeClass("disable")},error:function(){console.log("出现异常")}}),r)return!1;$(this).addClass("disable"),$.ajax({type:"post",dataType:"json",url:"/api/author/add",data:$("#add-user-form").serialize(),success:function(a){parseInt(a.code)&&window.location.reload(),$("#addModal").modal("hide")},error:function(){console.log("出现异常")}})}}),$("#user-content").on("click",".edit",function(a){var e=$(a.target).closest("tr").attr("data-userid"),t=$(a.target).closest("tr").attr("data-roleid");$.ajax({type:"post",data:{id:e},dataType:"json",url:"/api/author/getInfoById",success:function(a){console.log(a.data);var e=Handlebars.compile($("#edit-content").html());$("#editModal .modal-body").html(e(a.data)),$("#editModal .modal-body :radio[value="+t+"]").prop("checked",!0),$("#editModal").modal("show")}})}),$(".new-username").on("blur",function(){var a=$(this).val();if(self=this,a){var e={username:a};$.ajax({type:"post",url:"/api/account/check",data:e,dataType:"json",success:function(a){a.data?($(self).addClass("valid"),$(self).next().html("用户名已存在")):($(self).removeClass("valid"),$(self).next().html(""))}})}}),$("#user-content").on("click",".delete",function(a){if(!confirm("是否删除该权限?"))return!1;var e=$(a.target).closest("tr").attr("data-userid");$.ajax({type:"post",dataType:"json",url:"/api/author/delUserById",data:{id:e},success:function(a){1==a.code&&window.location.reload()},error:function(){console.log("出现异常")}}),$("#deleteModal").modal("hide")}),$("#search-btn").click(function(){var e=$("#search-name").val();""!=e?$.ajax({type:"post",dataType:"json",url:"/api/author/findUserByName",data:{username:e},beforeSend:function(){$(".user-list .loading").show(),$(".user-list > table").hide()},success:function(e){1==e.code&&(0!=e.data.length?$("#pagination-container").pagination({dataSource:e.data,callback:function(e){var t=a(e);$("#user-content").html(t)}}):$("#user-content").html("暂时没有数据"))},error:function(){console.log("出现异常")},complete:function(){$(".user-list .loading").hide(),$(".user-list > table").show()}}):window.location.reload()}),$("#editModal").on("click",".btn.updateEdit.edit",function(){if(!$(this).hasClass("disable")){var a=$("#edit-user-form").find("input[name='realname']"),e=$("#edit-user-form").find("input[name='username']");if(""==$.trim(a.val()))return a.addClass("valid"),a.next(".valid-msg").html("用户名不能为空"),!1;if(a.removeClass("valid"),a.next(".valid-msg").html(""),""==$.trim(e.val()))return e.addClass("valid"),e.next(".valid-msg").html("登录名不能为空"),!1;if(!/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/.test(e.val()))return e.addClass("valid"),e.next(".valid-msg").html("登录名必须是邮箱"),!1;e.removeClass("valid"),e.next(".valid-msg").html("");$(this).addClass("disable"),$.ajax({type:"post",dataType:"json",url:"/api/author/update",data:$("#edit-user-form").serialize(),success:function(a){parseInt(a.code)&&window.location.reload(),$("#addModal").modal("hide")},error:function(){console.log("出现异常")}})}})}();