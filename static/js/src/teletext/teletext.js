!function(){function e(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?a[2]:null}template.config("openTag","${"),template.config("closeTag","}");var t=e("pageIndex")||1,a=10;$("#search-btn").click(function(){var n=$(".form-telelist").serializeObject();return n.status||(n.status=null),$.ajax({url:"/api/internal/sas/ImageText/list",type:"get",dataType:"json",data:{pageIndex:t,pageSize:a,filter:JSON.stringify(n)},success:function(t){if(1==t.code&&t.data.length){{t.count?t.count:""}$("#tele-alertCnt").show(),$("#tele-alertInfo").hide();var n=(t.data,template("telelist-tpl",t));$("#teletext-list").html(n),$("#pagination").pagination({dataSource:new Array(t.count),pageSize:a,showGoInput:!0,showGoButton:!0,pageNumber:e("pageIndex")||1,afterPageOnClick:function(e,t){location.href="?pageIndex="+t.trim()},afterPreviousOnClick:function(e,t){location.href="?pageIndex="+t.trim()},afterNextOnClick:function(e,t){location.href="?pageIndex="+t.trim()},afterGoButtonOnClick:function(e,t){var a=t.trim();""!=a&&(location.href="?pageIndex="+a)},callback:function(){}})}else $("#tele-alertCnt").hide(),$("#tele-alertInfo").show()},error:function(){console.log("出现异常")}}),!1}),$.ajax({url:"/api/internal/sas/ImageText/list",type:"get",dataType:"json",data:{pageIndex:t,pageSize:a},success:function(t){if(1==t.code&&t.data.length){$("#tele-alertCnt").show(),$("#tele-alertInfo").hide();var n=(t.data,template("telelist-tpl",t));$("#teletext-list").html(n),$("#pagination").pagination({dataSource:new Array(t.count),pageSize:a,showGoInput:!0,showGoButton:!0,pageNumber:e("pageIndex")||1,afterPageOnClick:function(e,t){location.href="?pageIndex="+t.trim()},afterPreviousOnClick:function(e,t){location.href="?pageIndex="+t.trim()},afterNextOnClick:function(e,t){location.href="?pageIndex="+t.trim()},afterGoButtonOnClick:function(e,t){var a=t.trim();""!=a&&(location.href="?pageIndex="+a)},callback:function(){}})}else $("#tele-alertCnt").hide(),$("#tele-alertInfo").show()},error:function(){console.log("出现异常")}}),$("#teletext-list").on("click",".states-btn",function(){var e,t=$(this),a=t.closest("tr").data("ori"),n=t.find(".fa").data("value"),i=$("body").data("preview"),o=i.split("activity/")[0];(o.indexOf("qaapp.cn.m")>0||o.indexOf("preprod.cn.m")>0)&&(o=o.replace(/qaapp.cn.m/i,"qaappm.cn"),o=o.replace(/preprod.cn.m/i,"preprodm.cn")),e=o+"m/special/teletext/index.html?id="+a,"off"==n&&$.ajax({url:"/api/internal/sas/ImageText/setClose",type:"post",dataType:"json",data:{id:a,short_url:e},success:function(e){1==e.code&&(t.closest("tr").find(".sta").html('<i class="fa fa-lock"></i>关闭'),t.html('<i class="fa fa-check" data-value="on"></i>开启'))},error:function(){console.log("出现异常")}}),"on"==n&&$.ajax({url:"/api/internal/sas/ImageText/setOpen",type:"post",dataType:"json",data:{id:a,short_url:e},success:function(e){1==e.code&&(t.closest("tr").find(".sta").html('<i class="fa fa-unlock"></i>开启'),t.html('<i class="fa fa-power-off" data-value="off"></i>关闭'))},error:function(){console.log("出现异常")}})}),$("#teletext-list").on("click",".delete-btn",function(){if(!confirm("确定要删除这篇图文吗？"))return!1;var e=$(this),t=e.closest("tr").data("ori");$.ajax({url:"/api/internal/sas/ImageText/del",type:"post",dataType:"json",data:{id:t},success:function(e){1==e.code&&location.reload()},error:function(){console.log("出现异常")}})}),$("#teletext-list").on("click",".preview-btn",function(){var e,t=$(this),a=t.closest("tr").data("ori"),n=($(".header-container").data("magento"),$("body").data("preview")),i=n.split("activity/")[0];(i.indexOf("qaapp.cn.m")>0||i.indexOf("preprod.cn.m")>0)&&(i=i.replace(/qaapp.cn.m/i,"qaappm.cn"),i=i.replace(/preprod.cn.m/i,"preprodm.cn")),e=i+"m/special/teletext/index.html?id="+a,$(".teletextId > span").html(a),$("#qrCode").qrcode({width:64,height:64,text:e}),$(".qr .p-link p").html(e),$(".preview-wrapper .preview").html('<iframe src="'+e+'?preview=1" frameborder="0"></iframe>'),$(".preview-wrapper").show()}),$(".preview-wrapper .close").on("click",function(){$(".preview-wrapper .preview").html(""),$("#qrCode").html(""),$(".qr .link p").html(""),$(".preview-wrapper").hide()}),$.fn.serializeObject=function(){var e={},t=this.serializeArray();return $.each(t,function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e}}();