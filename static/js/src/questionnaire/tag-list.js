function getCategoryList(t){return t=t||{},$(".tag-right-content").hide(),ajaxReq({url:"/sas/tag/categoryList",data:t}).then(function(a){$(".tag-left-list").data("current-option",t),a.data.items.scene=scene,a.data.items.statsObj=statsObj,a.data.items.forEach(function(t){t.stringify=JSON.stringify(t)}),$(".tag-left-list table .data-container").html(parseTmpl({id:"tag-category-tmpl",data:a.data})),initPager({option:{page:a.data.page},totalCount:a.data.pageCount,pageElem:$(".tag-left-list .footer-pagenation"),method:getCategoryList})})}function getCategoryTags(t){ajaxReq({url:"/sas/tag/list",data:t}).then(function(a){$(".tag-right-content").data("current-option",t).attr("data-tags-count",10*parseInt(a.data.pageCount)),a.data.scene=scene,a.data.sceneArr=JSON.parse($(".tag-right-content table").attr("data-scene"));var e=a.data.sceneArr.reduce(function(t,a){return t[a]={scene_id:a,label:"",is_visible:"2"},t},{});a.data.items.length&&a.data.items.forEach(function(t){var a=t.list.length;t.list.forEach(function(t){e[t.scene_id]=t}),t.list=Object.keys(e).reduce(function(t,a){return t.push(e[a]),t},[]);var n=t.list.length;n-a>0&&(arguments[2].modified=!0),t.list.sort(function(t,a){return t.scene_id-a.scene_id})}),a.data.items.forEach(function(t){t.stringify=JSON.stringify(t)}),$(".tag-right-content table").html(parseTmpl({id:"tag-list-tmpl",data:a.data})),initPager({option:t,totalCount:a.data.pageCount,pageElem:$(".tag-right-content .footer-pagenation"),method:getCategoryTags})})}function initPager(t){t.pageElem.pagination({dataSource:new Array(Number(parseInt(t.totalCount)*parseInt(t.option.pageSize||10))),pageSize:t.option.pageSize||10,showGoInput:!0,showGoButton:!0,pageNumber:t.option.page||1,afterPageOnClick:function(a,e){t.method($.extend(t.option,{page:e}))},afterPreviousOnClick:function(a,e){t.method($.extend(t.option,{page:e}))},afterNextOnClick:function(a,e){t.method($.extend(t.option,{page:e}))},afterGoButtonOnClick:function(a,e){parseInt(t.totalCount)>=Number(e)&&""!==e&&t.method($.extend(t.option,{page:e}))},callback:function(){}})}var scene={1:"用户",2:"内容",3:"商品"},statsObj={1:localeI18n.active,2:localeI18n.inactive};$(function(){getCategoryList()}),$(".tag-left-list").on("click","tr",function(t){if("button"!=t.target.nodeName.toLowerCase()){var a=$(this);a.addClass("active").siblings().removeClass("active"),$(".tag-right-content").show(),$(".tag-right-content table").attr("data-scene",JSON.stringify(JSON.parse(this.getAttribute("data-stringify")).scene.sort(function(t,a){return t-a}))).attr("data-id",JSON.parse(this.getAttribute("data-stringify")).id).data("target",a),getCategoryTags({category_id:a.data("stringify").id,page:1})}}),$(document).on("click","[data-add-item]",function(){var t=JSON.parse($(".tag-right-content table").attr("data-scene")),a={sort:parseInt($(".tag-right-content").attr("data-tags-count"))+1,list:t.reduce(function(t,a){return t.push({scene_id:a,label:"",is_visible:""}),t},[]),status:1};$(".tag-right-content").attr("data-tags-count",a.sort),$(".tag-right-content .data-container").append(parseTmpl({id:"tag-list-item-tmpl",data:{items:[a]}}))}),$(".tag-right-content").on("change","[data-number]",function(t){if(!/^([\d]+)$/g.test(this.value-0)){alert("只能输入不小于0的整数！"),this.value=0;var a=this;setTimeout(function(){a.focus()}),t.stopPropagation()}}),$(".tag-right-content").on("change","tr",function(t){var a=$(this),e={};e.list=a.find("form:not([data-divide])").toArray().reduce(function(t,a){return t.push($(a).serializeObject()),t},[]),$.extend(e,a.find("[data-serialize]").serializeObject()),a.attr("data-stringify",JSON.stringify(e)).addClass("modified"),$(t.target).hasClass("color-warning")&&$(t.target).removeClass("color-warning")}),$("body").on("click",".modal .modal-submit-btn",function(){$(this).closest(".modal").find(".modal-body").find("form:visible").submit()}),$(document).on("click",'[data-save="tagList"]',function(){var t=$(".tag-right-content table").attr("data-id"),a=!0,e=$(".tag-right-content .modified").toArray().reduce(function(t,e){var n=JSON.parse(e.getAttribute("data-stringify"));return n.list.forEach(function(t){t.is_visible=t.is_visible||"2",a&&(a=!!t.label)}),t.push(n),t},[]);return e.length?a?void ajaxReq({url:"/sas/tag/save",type:"post",data:{data:JSON.stringify(e),category_id:t}}).then(function(t){alert(t.msg),getCategoryTags($(".tag-right-content").data("current-option"))}):(alert("还有必填项没有填写，无法保存！"),void $('.tag-right-content [name="label"]').filter(function(){return""===this.value}).addClass("color-warning").eq(0).focus()):void alert("无修改项，无需保存！")});var modalInfo={add:{title:localeI18n.add,btnName:localeI18n.add,hiddenFunc:function(){getCategoryList($(".tag-left-list").data("current-option"))},showFunc:function(){var t=$(this);$(this).find("form").validate({submitHandler:function(a){var e=$(a),n=e.serializeObject();n.scene=JSON.stringify([].concat(n.scene)),ajaxReq({url:"/sas/tag/categorySave",type:"post",data:n}).then(function(){t.modal("hide")})}})}},edit:{title:localeI18n.edit,btnName:localeI18n.save,hiddenFunc:function(){getCategoryList($(".tag-left-list").data("current-option"))},showFunc:function(){var t=$(this),a=t.data("target"),e=$(a).closest("tr"),n=e.data("stringify"),i=$(this).find("form")[0];Object.keys(n).forEach(function(t){Array.isArray(n[t])?n[t].forEach(function(a){$(i).find('[name="'+t+'"][value="'+a+'"]').prop("checked",!0).parent("label").addClass("disabled")}):$(i).find('[name="'+t+'"]').val(n[t])}),$(this).find("form").validate({submitHandler:function(a){var e=$(a),n=e.serializeObject();n.scene=JSON.stringify([].concat(n.scene)),ajaxReq({url:"/sas/tag/categorySave",type:"post",data:n}).then(function(){t.modal("hide")})}})}}};