$(document).ready(function(){function a(){var a=$(".videoForm").find("input[name=tags]").val();if(a)for(var e=a.split(","),i=$(".label-tags li"),t=0;t<i.length;t++)for(var s=$(i[t]).data("tagid"),l=0;l<e.length;l++)s==e[l]?$(i[t]).addClass("current"):$(i[t]).removeClass("current");else $(".label-tags li").removeClass("current")}function e(){var a,e=$(".label-list .clearfix li"),i=[];if(e.length>0){for(var t=0;t<e.length;t++){var s=$(e[t]).data("tagid");i.push(s)}a=i.toString(),$(".videoForm").find("input[name=tags]").val(a)}else $(".videoForm").find("input[name=tags]").val("")}function i(a){return $(".videoForm .waiting").is(":visible")?(alert("视频未压缩完成,请在压缩完成保存!"),void $(".saveVideo").removeClass("disable")):$(".videoForm .pro").is(":visible")?(alert("视频正在上传,请上传并压缩完成保存!"),void $(".saveVideo").removeClass("disable")):$(".videoForm .fail").is(":visible")?(alert("视频压缩失败,请重新上传!"),void $(".saveVideo").removeClass("disable")):$.trim(a.video_url)?$.trim(a.title)?$.trim(a.status)?"请选择"==a.category?(alert("请选择视频分类!"),void $(".saveVideo").removeClass("disable")):$.trim(a.short_desc)?$.trim(a.tags)?!0:(alert("请选择标签!"),void $(".saveVideo").removeClass("disable")):(alert("请填写简介!"),void $(".saveVideo").removeClass("disable")):(alert("请选择视频状态!"),void $(".saveVideo").removeClass("disable")):(alert("请填写视频名称!"),void $(".saveVideo").removeClass("disable")):(alert("请上传视频!"),void $(".saveVideo").removeClass("disable"))}var t=$(".videoForm input[name=video_id]").val();t&&$.ajax({type:"get",dataType:"json",url:"/api/internal/sas/tag/getObjTag?scene=2&id="+t,success:function(a){if(1==a.code){var e="",i=[];if(a.data.length>0)for(var t=0;t<a.data.length;t++)e+="<li data-tagid="+a.data[t].tag_id+">"+a.data[t].label+'<i class="close-btn">×</i></li>',i.push(a.data[t].tag_id);$(".label-list .clearfix").append(e),$(".videoForm").find("input[name=tags]").val(i.toString())}else 0==a.code&&alert(a.msg)},error:function(){console.log("出现异常")}}),$.ajax({type:"get",dataType:"json",url:"/api/internal/sas/tag/getComponentCategory?scene=2&type=1",success:function(e){if(1==e.code){var i="";if(e.data.length>0){for(var t=0;t<e.data.length;t++)i+="<li data-categoryid="+e.data[t].category_id+">"+e.data[t].name+"</li>";$(".label-category").append(i),$(".label-category li:first-child").addClass("current");var s=e.data[0].category_id;$.ajax({type:"get",dataType:"json",url:"/api/internal/sas/tag/getComponentTag?scene=2&category_id="+s,success:function(e){if(1==e.code){var i="";if(e.data.length>0)for(var t=0;t<e.data.length;t++)i+="<li data-tagid="+e.data[t].tag_id+">"+e.data[t].label+"</li>";$(".label-tags").append(i),a()}else 0==e.code&&alert(e.msg)},error:function(){console.log("出现异常")}})}}else 0==e.code&&alert(e.msg)},error:function(){console.log("出现异常")}}),$(".label-category").on("click","li",function(){if(!$(this).hasClass("current")){$(this).addClass("current").siblings().removeClass("current");var e=$(this).data("categoryid");$.ajax({type:"get",dataType:"json",url:"/api/internal/sas/tag/getComponentTag?scene=2&category_id="+e,success:function(e){if(1==e.code){var i="";if(e.data.length>0)for(var t=0;t<e.data.length;t++)i+="<li data-tagid="+e.data[t].tag_id+">"+e.data[t].label+"</li>";$(".label-tags").html(""),$(".label-tags").append(i),a()}else 0==e.code&&alert(e.msg)},error:function(){console.log("出现异常")}})}}),$(".label-tags").on("click","li",function(){var a=$(this).data("tagid"),i="[data-tagid="+a+"]";if($(".label-list .clearfix").find(i).remove(),$(this).hasClass("current"))$(this).removeClass("current");else{$(this).addClass("current");var t=$(this).clone();$(t).append("<i class='close-btn'>×</i>"),$(".label-list .clearfix").append(t)}e()}),$(".label-list .clearfix").on("click",".close-btn",function(){$(this).parent("li").remove(),e(),a()}),$(".label-more").click(function(){var a=$(".label-more");a.hasClass("open")?(a.html('更多<i class="fa fa-angle-right"></i>'),a.removeClass("open")):(a.html('收起<i class="fa fa-angle-down"></i>'),a.addClass("open"))}),$.fn.serializeObject=function(){var a={},e=this.serializeArray();return $.each(e,function(){void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a},$(".videoForm").on("click",".close-btn",function(){$(".videoForm").find(".imgBox").removeClass("showImg"),$(".videoForm").find("input[name=img_url]").val(""),$(".imgUrl").attr("src","")}),$(".videoCon").on("click",".saveVideo",function(){if(!$(this).hasClass("disable")){$(this).addClass("disable");var a=$(".videoForm").serializeObject();i(a)&&$.ajax({type:"post",dataType:"json",url:"/api/internal/sas/video/save",data:a,success:function(a){if(1==a.code)alert(a.msg),window.location.href="/video/add/"+a.data.video_id;else if(0==a.code){var e="";if(a.data.length>0)for(var i=0;i<a.data.length;i++)e+=a.data[i]+" ";alert(a.msg+":"+e)}$(".saveVideo").removeClass("disable")},error:function(){console.log("出现异常")}})}})});