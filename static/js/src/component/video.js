var videoComponent=Vue.extend({props:["setting"],data:function(){return{extendClass:{video:!0}}},template:'<li class="template" :class="extendClass" data-field="video" :data-setting="setting | json">\n    <div class="block-img">\n        <div>\n            <img src="/img/static/img/component/video_block.png">\n        </div>\n        <p>视频组件</p>\n    </div>\n    <div class="canvas-img" >\n        <img src="/img/static/img/component/video_canvas.png">\n        <i class="close-btn">×</i>\n    </div>\n</li>',methods:{},created:function(){}});Vue.component("video",videoComponent);var videoFormComponent=Vue.extend({data:function(){return{setting:{},show:!1,i18n:window.i18n[document.body.getAttribute("data-localize")]}},methods:{addVideo:function(){var e=this,t=$(event.currentTarget).closest(attrClass),i=uuid();e.setting.data.push({status:"1",start_time:"",end_time:"",video_id:"",video_title:"",video_url:"",video_img:"",id:i}),binChange();var n=setTimeout(function(){e.resetSetting(t),clearTimeout(n)},30)},initDate:function(e,t,i){var n={};t&&"start"==i&&(n.maxDate=t),t&&"end"==i&&(n.minDate=t),$(e.target).datetimepicker({onShow:function(){this.setOptions(n)}})},slideItem:function(e){var t=e.currentTarget;$(t).find(".fa").toggleClass("fa-caret-right"),$(t).siblings(".itemBody").slideToggle()},status:function(e){var t=$("body").data("state"),i=$("body").data("server-time"),n=e.status,a=e.start_time.replace(/-/g,"/"),s=new Date(a).getTime()/1e3,o=e.end_time.replace(/-/g,"/"),d=new Date(o).getTime()/1e3;return 1==t?1==n?s>i?"未开始":d>i?"已上线":"已过期":"已关闭":0==n?"已关闭":"--"},shutVideo:function(e){for(var t=this,i=$(e.currentTarget).closest(attrClass),n=$(e.currentTarget).closest(".singleItem").find(".uid").val(),a=t.setting.data,s=0;s<a.length;s++)n==a[s].id&&(a[s].status=0);t.setting.data=a;var o=setTimeout(function(){t.resetSetting(i);var n=$("body").data("state");saveData(n,function(e){1==e.code?window.location.href="/app/home/"+e.data.pageId:alert(e.msg)},$(e.currentTarget)),clearTimeout(o)},30)},emptyVideo:function(e){var t=this,i=$(e.currentTarget).closest(attrClass),n=$(e.currentTarget).closest(".singleItem");$(n).find("input[name=video_title]").val(""),$(n).find("input[name=video_url]").val(""),$(n).find("input[name=video_img]").val(""),$(n).find(".videoImg").hide().attr("src","");var a=setTimeout(function(){t.resetSetting(i),clearTimeout(a)},300)},readVideo:function(e){var t=this,i=$(e.currentTarget).closest(attrClass),n=$(e.currentTarget).closest(".singleItem"),a=$(n).find("input[name=video_id]").val();if(a){var s={video_id:a};$.ajax({type:"get",dataType:"json",url:"/api/internal/sas/video/list",data:s,success:function(e){if(1==e.code)if(0!=e.total&&1==e.data[0].status){var a=e.data[0];$(n).find("input[name=video_title]").val(a.title),$(n).find("input[name=video_url]").val(a.video_url);var s;s=a.img_url?a.img_url:a.video_img,$(n).find("input[name=video_img]").val(s),$(n).find(".videoImg").show().attr("src",s);var o=setTimeout(function(){t.resetSetting(i),clearTimeout(o)},300)}else 0!=e.total&&0==e.data[0].status?alert("该视频状态为关闭状态"):0==e.total&&alert("无该视频")},error:function(){console.log("出现异常")}})}else{$(n).find("input[name=video_title]").val(""),$(n).find("input[name=video_url]").val(""),$(n).find("input[name=video_img]").val(""),$(n).find(".videoImg").hide().attr("src","");var o=setTimeout(function(){t.resetSetting(i),clearTimeout(o)},300)}},openVideo:function(e){for(var t=this,i=$(e.currentTarget).closest(attrClass),n=$(e.currentTarget).closest(".singleItem").find(".uid").val(),a=t.setting.data,s=0;s<a.length;s++)n==a[s].id&&(a[s].status=1);t.setting.data=a;var o=setTimeout(function(){t.resetSetting(i);var n=$("body").data("state");saveData(n,function(e){1==e.code?window.location.href="/app/home/"+e.data.pageId:alert(e.msg)},$(e.currentTarget)),clearTimeout(o)},30)},deleteVideo:function(e){for(var t=this,i=$(e.currentTarget).closest(attrClass),n=$(e.currentTarget).closest(".singleItem").find(".uid").val(),a=t.setting.data,s=[],o=0;o<a.length;o++)n!=a[o].id&&s.push(a[o]);t.setting.data=s;var d=setTimeout(function(){t.resetSetting(i);var n=$("body").data("state");saveData(n,function(e){1==e.code?window.location.href="/app/home/"+e.data.pageId:alert(e.msg)},$(e.currentTarget)),clearTimeout(d)},30)},resetSetting:function(e){var t=$(e).find("form.commonConf").eq(0).serializeObject(),i=$(e).find(".singleConf form.singleItem"),n=$(i).length,a=[];if(n>0)for(var s=0;n>s;s++)a.push($(i[s]).serializeObject());var o=_.extend(t,{data:a});resetForm(o)},subForm:function(){}},template:'<div class="video-attr attr-form" v-show="show" role="form">\n    <div class="panel-group">\n        <div class="panel panel-default">\n            <div class="panel-heading"><a data-toggle="collapse" data-parent="#video" href="#video">视频组件</a>\n            </div>\n            <div id="video" class="panel-collapse collapse">\n                <div class="panel-body">\n                    <form class="commonConf">\n                        <div class="form-group ">\n                            <div>背景图片URL(建议750*1240)</div>\n                            <img class="thumbnail"  v-if="setting.bg_img" :src="setting.bg_img">\n                            <input class="form-control input-sm bgImg removeSpace" value="${setting.bg_img}" v-model="setting.bg_img" name="bg_img" placeholder="${i18n.bannerBg}"\n                                   type="text">\n                        </div>\n                        <div class="form-group ">\n                            <div><em class="red">*</em>模块title</div>\n                            <input class="form-control input-sm" value="${setting.title}" v-model="setting.title" name="title" type="text">\n                        </div>\n                        <input type="hidden" class="has_change" name="has_change" value="${setting.has_change}">\n                    </form>\n\n                    <div v-if="setting.data && setting.data.length>0" class="videoGroup singleConf">\n                        <form  v-for="(i,video) in setting.data" class="videoItem singleItem">\n                            <input type="hidden" class="uid" name="id" value="${video.id}">\n                            <a class="itemTitle" @click="slideItem($event)">视频配置(${video.start_time}-${video.end_time},${status(video)}) <i class="fa fa-caret-down"></i></a>\n                            <div class="itemBody">\n                                <div class="form-group">\n                                    <div><em class="red">*</em>视频ID</div>\n                                    <input class="form-control input-sm position" @keydown="emptyVideo($event)" value="${video.video_id}" v-model="video.video_id" name="video_id" type="text">\n                                    <a class="btn btn-success btn-sm readVideo" @click="readVideo($event)" type="button">${i18n.read}</a>\n                                </div>\n                                <div class="form-group">\n                                    <div><em class="red">*</em>视频名称</div>\n                                    <input class="form-control input-sm grayInput" value="${video.video_title}" onkeydown="return false" name="video_title" type="text">\n                                </div>\n                                <div class="form-group">\n                                    <div><em class="red">*</em>视频链接</div>\n                                    <input class="form-control input-sm grayInput" value="${video.video_url}" onkeydown="return false"  name="video_url" type="text">\n                                </div>\n                                <div class="form-group">\n                                    <div><em class="red">*</em>封面图片</div>\n                                    <input class="form-control input-sm grayInput" value="${video.video_img}" onkeydown="return false" name="video_img" type="text">\n                                    <img class="thumbnail videoImg"  v-show="video.video_img" :src="video.video_img" v-model="video.video_img">\n                                </div>\n                                <div class="form-group">\n                                    <div><em class="red">*</em>开始时间</div>\n                                    <input @mousedown="initDate($event,video.end_time,\'start\')" v-model="video.start_time" class="form-control input-sm startTime" value="${video.start_time}"  name="start_time" placeholder="${i18n.start_time}"\n                                           type="text">\n                                </div>\n                                <div class="form-group">\n                                    <div><em class="red">*</em>结束时间</div>\n                                    <input @mousedown="initDate($event,video.start_time,\'end\')" v-model="video.end_time" class="form-control input-sm endTime" value="${video.end_time}" name="end_time" placeholder="${i18n.end_time}" type="text">\n                                </div>\n                                <div class="form-group">\n                                    <div class="ops">\n                                        <a class="btn btn-warning btn-sm shutVideo" @click="shutVideo($event)" :class="{\'active\':video.status==1}" type="button">${i18n.shut}\n                                        </a>\n                                        <a class="btn btn-success btn-sm openVideo" @click="openVideo($event)" :class="{\'active\':video.status==0}" type="button">${i18n.open}\n                                        </a>\n                                    </div>\n                                    <input class="status" type="hidden" name="status" value="${video.status}">\n                                </div>\n                            </div>\n                            <div class="form-group delIcon">\n                                <div class="ops">\n                                    <a class="btn btn-sm delBanner" @click="deleteVideo($event)" type="button">×</a>\n                                </div>\n                            </div>\n                        </form>\n                    </div>\n                    <a @click="addVideo($event)" class="addVideo btn btn-primary">${i18n.add_config} + </a>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n',created:function(){console.log()}});Vue.component("video-form",videoFormComponent);