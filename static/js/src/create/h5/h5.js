!function(){template.config("openTag","${"),template.config("closeTag","}");var e=function(){var e={},t=$(attrComm).serializeObject();e.root=t;var i=$("[data-setting]"),r=[];return i.each(function(e){var t=$(this),i=t.width(),s=t.height(),a=t.find(".link"),n=t.find(".addVideo-cont"),o=JSON.parse(t.attr("data-setting"));if(o.position=e,a.length>0){var p=[],h=[];a.each(function(){var e={css:{left:parseInt($(this).css("left"))/i*100+"%",top:parseInt($(this).css("top"))/s*100+"%",width:$(this).width()/i*100+"%",height:$(this).height()/s*100+"%",position:"absolute",zIndex:"100"},url:$.trim($(this).find(".link-url").text())};$(this).hasClass("link-popup")?(e.img=$(this).find(".pop-img-url").text(),e.url=$.trim($(this).find(".link-url").text()),e.type=$(this).find(".link-type").text(),h.push(e)):p.push(e)}),o.links=p,o.linksPopup=h}else delete o.links,delete o.linksPopup;if(t.hasClass("tVideo")){if(n.length>0){var l={left:parseInt(n.css("left"))/i*100+"%",top:parseInt(n.css("top"))/s*100+"%",width:n.width()/i*100+"%",height:n.height()/s*100+"%",position:"absolute",zIndex:"100"};o.videocss=l}else delete o.videocss,delete o.videoUrl;o.videoBackground=o.videoBackground||"/img/video.png"}r.push(o)}),e.field=r,e};$.fn.serializeObject=function(){var e={},t=this.serializeArray();$.each(t,function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""});var i=$("input[type=radio],input[type=checkbox]",this);return $.each(i,function(){e.hasOwnProperty(this.name)||(e[this.name]="")}),e};var t=function(t,i){var r=e();formValidator(r,i,function(){$.post("/api/h5/save",{cid:r.root.cid,d:r.root.d,title:r.root.title,key:r.root.urlkey,setting:JSON.stringify(r),state:$("body").data("state")},function(e){t&&t(e,r)}).error(function(){alert("error")})})};$("#save-btn").on("click",function(){$(this).hasClass("disable")||($(this).addClass("disable"),t(function(e,t){var i=t.root.urlkey,r=$("body").data("preview")+i+"?preview=1";$(".preview").append("<iframe src="+r+" frameborder='0'></iframe>"),alert(constant.save_success),window.location.reload()},$(this)))}),$("#preview-btn").on("click",function(){t(function(e,t){var i=t.root.urlkey,r=$("body").data("preview")+i+"?preview=1",s=$("body").data("preview")+i;$(".preview").append("<iframe src="+r+" frameborder='0'></iframe>"),$("#qrCode").qrcode({width:64,height:64,text:s}),$(".qr .p-link p").html(s),$(".preview-wrapper").show()},$(this))}),$(".preview-wrapper .close").on("click",function(){$(".preview").html(""),$("#qrCode").html(""),$(".qr .p-link p").html(""),$(".preview-wrapper .preview").html(""),$(".preview-wrapper").hide()})}();