var resetForm=function(e){var t=$(CANVAS_PANEL).find(".cur"),a=JSON.parse(t.attr(SETTING));e=_.extend(a,e),t.attr(SETTING,JSON.stringify(e));var n={l1:l1Event,img:imgEvent,purchase:purchaseEvent,countdown:countdownEvent,video:videoEvent,anchor:anchorEvent,flashsale:flashsaleEvent,benefits:benefitsEvent,win:winEvent,presale:presaleEvent,groupon:grouponEvent,comment:commentEvent,support:supportEvent,live:liveEvent,topnav:topnavEvent,seckill:seckillEvent,newcomercoupon:newcomercouponEvent};n[e.type]&&n[e.type](e)};$(TEMPLATE_PANEL).sortable({group:{name:"template",pull:"clone"},sort:!0,fallbackOnBody:!0}),$(IMG_PANEL).sortable({group:{name:"img",pull:"clone"},fallbackOnBody:!0}),$(CANVAS_PANEL).sortable({group:{name:"canvas",put:["template","img"],draggable:"[data-field]"},sort:!0,onUpdate:function(){console.log(123)},onAdd:function(e){var t=$(e.item),a=$(e.item).attr("data-field"),n={id:uuid(),type:t.attr("data-field")};console.log(a),t.attr("chosenimg")&&(n.imgSrc=t.attr("chosenimg")),DEFAULT_SETTING[a]&&(n=_.extend(n,DEFAULT_SETTING[a])),$(e.item).attr("id",n.id).attr(SETTING,JSON.stringify(n))}}),$(CANVAS_PANEL).on("click","[data-field]",function(e){e.stopPropagation(),e.preventDefault();var t=$(this);t.addClass("cur").siblings(".cur").removeClass("cur");var a=t.attr("data-field"),n="."+a+"-attr";$(n).show().siblings(attrClass).hide();var o=JSON.parse(t.attr(SETTING));$(n).find("input:not([type=checkbox])").val(""),console.log($(n).find("input[name$='imgSrc']").length),$(n).find("input[name$='imgSrc']").each(function(){$(this).val(t.attr("chosenimg"))});for(var i in o)if(o[i]){if("imgRadios"==i){var l=$(n).find("#imgRadios"+o[i]);l.prop("checked",!0),l.val(l.data("value"))}else $(n).find("[name="+i+"]").val(o[i]);"isLogin"==i&&1==o[i]&&($(".loginMsg").show(),$(n).find("[name="+i+"]").prop("checked",!0))}else"imgRadios"==i&&$(n).find("#imgRadios").prop("checked",!0);if("flashsale"==o.type){var r=template("flashsaleTable",o);$(".flashsale-table-content").html(r);var s=$(".flashsale-attr .flashsale-table-content .table");s.each(function(e,t){var a=$(t).find("[data-flashdatepicker]").datetimepicker({timepicker:!1,lang:"ch",format:"Y/m/d"});a.off("mousewheel.xdsoft"),$(t).find("[data-flashtimepicker]").datetimepicker({datepicker:!1,lang:"ch",format:"H:i"}),$(t).find(".flash-tab").html("tab"+(e+1))})}if("topnav"===o.type){var c=template("topNavTab",o);$(".topnav-body").html(c)}if("newcomercoupon"===o.type){var d=template("newcomercouponTemplate",o);$(".newcomercoupon-body").html(d)}if("win"==o.type){var p=o.winInfo;if(p)for(var v=0;v<p.length;v++){var f=$(".win-table:eq("+v+")");f.find(".winfrom").val(p[v].from),f.find(".winto").val(p[v].to),f.find("[data-csv]").attr("data-csv",JSON.stringify(p[v].csv)),p[v].csv.length&&f.find(".csv-name").html(constant.saved)}else $(".csv-name").html("NA")}}),$(attrClass).on("change","input,select",function(e){var t=$(e.currentTarget);$(e.currentTarget).is("[type=radio]")&&t.val(t.data("value"));var a=t.closest("form").serializeObject();resetForm(a)}),$(CANVAS_PANEL).on("click",".close-btn",function(e){e.stopPropagation(),e.preventDefault(),$(attrClass).hide(),$(this).closest("li").remove()}),$(CANVAS_PANEL).on("click",".close-link-btn",function(e){e.stopPropagation(),e.preventDefault(),$(this).closest(".link").remove()}),$(CANVAS_PANEL).on("click",".close-video-btn",function(e){e.stopPropagation(),e.preventDefault(),$(this).closest(".addVideo-cont").remove()});